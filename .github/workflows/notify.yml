on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
      event_name:
        required: true
        type: string
      pr_url:
        required: false
        type: string
      pr_title:
        required: false
        type: string
      commit_msg:
        required: false
        type: string

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # Push: plain text only, no colored box
      - name: Notify Commit
        if: inputs.event_name == 'push'
        run: |
          curl -X POST -H 'Content-Type: application/json' \
            -d '{"text": "'"$COMMIT_MSG"'"}' \
            "$WEBHOOK_URL"
        env:
          WEBHOOK_URL: ${{ secrets.MATTERMOST_WEBHOOK_URL }}
          COMMIT_MSG: ${{ inputs.commit_msg }}

      # PR: colored box with title and link
      - name: Notify PR
        if: inputs.event_name == 'pull_request'
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.MATTERMOST_WEBHOOK_URL }}
          SLACK_USERNAME: 'Satsavi CI/CD'
          SLACK_TITLE: ${{ inputs.pr_title }}
          SLACK_MESSAGE: ${{ inputs.pr_url }}
          SLACK_COLOR: '#36a64f'

      # Release: colored box with deployment info
      - name: Notify Deployment
        if: inputs.event_name == 'release'
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.MATTERMOST_WEBHOOK_URL }}
          SLACK_USERNAME: 'Satsavi CI/CD'
          SLACK_TITLE: 'Deployment: ${{ github.repository }}'
          SLACK_MESSAGE: >-
            Commit: "${{ inputs.commit_msg }}"
            Status: ${{ inputs.status }} on ${{ github.ref_name }}
          SLACK_COLOR: ${{ inputs.status == 'success' && '#36a64f' || '#af111c' }}